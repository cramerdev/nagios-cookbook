# Nagios Service Definitions.
#
# Automatically generated by Chef.

define service {
    use                 default-service
    host_name           *
    service_description ping
    check_command       check_ping!200.0,20%!500.0,60%
}

<% unless @service_hosts[node['nagios']['server_role'] || 'monitoring'].nil? -%>
# monitoring service checks
define service {
    service_description Nagios
    hostgroup_name      <%= node[:nagios][:server_role] || 'monitoring' %>
    check_command       check-nagios
    contact_groups      admins
    use                 default-service
}
<% end -%>

# default checks for all hosts
# Uncomment if you're running chef-client as a daemon
#define service {
#    service_description Chef Client
#    hostgroup_name     base
#    check_command      check_chef_client
#    use                default-service
#}

define service {
    service_description Free Space All Disks
    hostgroup_name      <%= node['nagios']['nrpe_hostgroup'] %>
    check_command       check_all_disks
    use                 default-service
}

define service {
    service_description Load Average
    hostgroup_name      <%= node['nagios']['nrpe_hostgroup'] %>
    check_command       check_load
    use                 default-service
}

#define service {
    #service_description Free Memory
    #hostgroup_name      <%= node['nagios']['nrpe_hostgroup'] %>
    #check_command    		check_mem
    #use                 default-service
#}

define service {
    service_description Free Swap
    hostgroup_name      <%= node['nagios']['nrpe_hostgroup'] %>
    check_command       check_swap
    use                 default-service
}

<% unless @service_hosts['ssh_server'].nil? -%>
define service {
    service_description SSH
    hostgroup_name      ssh_server
    check_command       check_ssh
    use                 default-service
}
<% end -%>

define service {
    service_description Processes
    hostgroup_name      <%= node['nagios']['nrpe_hostgroup'] %>
    check_command       check_local_procs
    use                 default-service
}

define service {
    service_description Open File Descriptors
    hostgroup_name      <%= node['nagios']['nrpe_hostgroup'] %>
    check_command       check_open_fds
    use                 default-service
}

<% unless @service_hosts['gearman_server'].nil? -%>
# Gearman
define service {
    service_description Gearman Daemon
    hostgroup_name      gearman_server
    check_command       check_nrpe!check_gearmand
    use                 default-service
}
<% end %>

<% unless @service_hosts['graphite_server'].nil? -%>
# Carbon (graphite)
define service {
    service_description Carbon
    hostgroup_name      graphite_server
    check_command       check_nrpe!check_carbon
    use                 default-service
}
<% end -%>

# basic web server http check
<% unless @service_hosts['web'].nil? -%>
define service {
    service_description HTTP Processes
    hostgroup_name      <%= (node['nagios']['hostgroups']['web'] || ['web']).join(',') %>
    check_command       check_http
    use                 default-service
}
<% end -%>

<% unless @service_hosts['mysql_server'].nil? -%>
define service {
    service_description MySQL Server
    hostgroup_name      mysql_server
    check_command       check_nrpe!check_mysql_server
    use                 default-service
}

<% end -%>

# Chef Server
<% unless @service_hosts['chef_server'].nil? -%>
define service {
    service_description CouchDB
    hostgroup_name      chef_server
    check_command       check_nrpe!check_couchdb
    use                 default-service
}

define service {
    service_description Solr
    hostgroup_name      chef_server
    check_command       check_nrpe!check_solr
    use                 default-service
}

define service {
    service_description RabbitMQ
    hostgroup_name      chef_server
    check_command       check_nrpe!check_rabbitmq
    use                 default-service
}
<% end -%>

<% unless @service_hosts['nfs_server'].nil? -%>
# NFS
define service {
    service_description NFS
    hostgroup_name      nfs_server
    check_command       check_nrpe!check_nfs
    use                 default-service
}
<% end -%>

<% unless @service_hosts['delayed_job_server'].nil? -%>
# Delayed Job
define service {
    service_description Delayed Job
    hostgroup_name      delayed_job_server
    check_command       check_nrpe!check_delayed_job
    use                 default-service
}
<% end -%>

# Ganglia gmond
define service {
    service_description Ganglia monitoring
    hostgroup_name      <%= node['nagios']['nrpe_hostgroup'] %>
    check_command       check_nrpe!check_gmond
    use                 default-service
}

<% unless @service_hosts[node['nagios']['server_role'] || 'monitoring'].nil? -%>
# Ganglia gmetad
define service {
    service_description Ganglia Meta Daemon
    # nagios & gmetad shared here
    hostgroup_name      <%= node[:nagios][:server_role] || 'monitoring' %>
    check_command       check_nrpe!check_gmetad
    use                 default-service
}
<% end -%>

# New Relic
define service {
    service_description New Relic server monitoring
    hostgroup_name      <%= node['nagios']['nrpe_hostgroup'] %>
    check_command       check_nrpe!check_newrelic
    use                 default-service
}

<% unless @service_hosts['redis_server'].nil? -%>
# Redis
define service {
    service_description Redis
    hostgroup_name      redis_server
    check_command       check_nrpe!check_redis
    use                 default-service
}
<% end -%>

<% unless @service_hosts['stats_server'].nil? -%>
# StatsD
define service {
    service_description StatsD
    hostgroup_name      stats_server
    check_command       check_nrpe!check_statsd
    use                 default-service
}
<% end -%>

# Supervisor
define service {
    service_description Supervisor
    hostgroup_name      <%= node['nagios']['nrpe_hostgroup'] %>
    check_command       check_supervisorctl
    use                 default-service
}

# Syslog NG
define service {
    service_description syslog-ng
    hostgroup_name      <%= node['nagios']['nrpe_hostgroup'] %>
    check_command       check_nrpe!check_syslog-ng
    use                 default-service
}
